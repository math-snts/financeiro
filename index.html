<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meu Controle Financeiro</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #1f2937;
      --text: #e5e7eb;
      --text-dim: #9ca3af;
      --accent: #22c55e;
      --accent-2: #3b82f6;
      --danger: #ef4444;
      --warn: #f59e0b;
      --radius: 18px;
    }
    body.light {
      --bg: #f9fafb;
      --card: #ffffff;
      --muted: #e5e7eb;
      --text: #111827;
      --text-dim: #374151;
      --accent: #22c55e;
      --accent-2: #2563eb;
      --danger: #dc2626;
      --warn: #d97706;
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
    }
    header {
      position: sticky;
      top: 0;
      background: rgba(15,23,42,.8);
      backdrop-filter: saturate(180%) blur(8px);
      border-bottom: 1px solid var(--muted);
      z-index: 10;
    }
    body.light header {
      background: rgba(249,250,251,.8);
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px }
    .row { display: flex; gap: 12px; flex-wrap: wrap }
    .grow { flex: 1 1 280px }
    h1 { font-size: 22px; margin: 0; font-weight: 700 }
    nav { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px }
    nav button {
      background: var(--bg);
      border: 1px solid var(--muted);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 999px;
      cursor: pointer;
    }
    nav button.active {
      background: var(--accent-2);
      border-color: transparent;
      color: #fff;
    }
    main { max-width: 1100px; margin: 16px auto; padding: 0 18px 70px }
    .grid { display: grid; gap: 14px }
    .grid.cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)) }
    @media (max-width:900px){.grid.cols-3{grid-template-columns:1fr}}
    .card {
      background: var(--card);
      border: 1px solid var(--muted);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: 0 6px 30px rgba(0,0,0,.25);
    }
    .card h2 { margin: 0 0 12px; font-size: 18px }
    .muted { color: var(--text-dim) }
    .kpi { font-size: 26px; font-weight: 800 }
    .row-inline { display: flex; gap: 10px; align-items: center; flex-wrap: wrap }
    label { font-size: 12px; color: var(--text-dim) }
    input,select {
      width: 100%; padding: 10px 12px; background: var(--bg);
      border: 1px solid var(--muted); border-radius: 12px; color: var(--text)
    }
    .btn {
      background: var(--accent-2);
      color: white; border: none;
      padding: 10px 14px; border-radius: 12px;
      cursor: pointer; font-weight: 600
    }
    .btn.ghost { background: var(--bg); border: 1px solid var(--muted); color: var(--text) }
    .btn.warn { background: var(--warn) }
    .btn.danger { background: var(--danger) }
    table { width: 100%; border-collapse: collapse }
    th, td { padding: 10px; border-bottom: 1px solid var(--muted); text-align: left }
    th { color: var(--text-dim); font-weight: 600; font-size: 12px; text-transform: uppercase }
    tfoot td { font-weight: 700 }
    .tag { padding: 4px 8px; border-radius: 999px; font-size: 11px; border: 1px solid var(--muted) }
    .right { text-align: right }
    .space-top { margin-top: 12px }
    .note { font-size: 12px; color: var(--text-dim) }
    footer { position: fixed; bottom: 10px; left: 0; right: 0; display: flex; justify-content: center; pointer-events: none }
    .dock { pointer-events: auto; background: var(--bg); border: 1px solid var(--muted); border-radius: 999px; padding: 8px 10px; display: flex; gap: 8px; box-shadow: 0 10px 30px rgba(0,0,0,.35) }

    /* Switch iOS */
    .switch { position: relative; display: inline-flex; align-items: center; gap:6px; cursor: pointer; }
    .switch input { display:none }
    .slider {
      width: 46px; height: 24px; background: var(--muted); border-radius: 999px;
      position: relative; transition:.3s;
    }
    .slider::before {
      content:""; position:absolute; top:2px; left:2px;
      width:20px; height:20px; border-radius:50%;
      background:#fff; transition:.3s;
    }
    input:checked + .slider::before { transform: translateX(22px) }
    input:checked + .slider { background: var(--accent-2) }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row" style="align-items:center;justify-content:space-between">
        <div class="grow">
          <h1>ðŸ’° Meu Controle Financeiro</h1>
          <div class="muted">Controle seus ganhos e despesas por perÃ­odo</div>
        </div>
        <div class="row-inline">
          <select id="periodSelect" class="btn ghost" style="width:auto"></select>
          <label class="switch">
            <span id="themeIcon">ðŸŒž</span>
            <input type="checkbox" id="themeToggle">
            <span class="slider"></span>
            <span></span>
          </label>
        </div>
      </div>
      <nav id="tabs"></nav>
    </div>
  </header>

  <main>
    <!-- DASHBOARD -->
    <section id="tab-dashboard" class="tab card" hidden>
      <h2>ðŸ“Š Dashboard</h2>
      <div class="grid cols-3">
        <div class="card">
          <div class="muted">Saldo previsto</div>
          <div class="kpi" id="kpiSaldo">R$ 0,00</div>
          <div class="note">Entradas</div>
        </div>
        <div class="card">
          <div class="muted">PrÃ³ximo vencimento</div>
          <div class="kpi" id="kpiVencimento">â€”</div>
          <div class="note">Despesas e cartÃµes mais prÃ³ximos</div>
        </div>
        <div class="card">
          <div class="muted">Sobra</div>
          <div class="kpi" id="kpiSobra">R$ 0,00</div>
          <div class="note">Saldo apÃ³s todas as despesas</div>
        </div>
      </div>
    </section>

    <!-- RENDA -->
    <section id="tab-renda" class="tab card" hidden>
      <h2>ðŸ’µ Renda</h2>
      <div class="row">
        <div class="grow"><label>DescriÃ§Ã£o</label><input id="rendaNome" placeholder="SalÃ¡rio, Extra..."></div>
        <div class="grow"><label>Valor</label><input id="rendaValor" type="number" step="0.01"></div>
        <div class="grow"><label>Data</label><input id="rendaData" type="date"></div>
        <button id="btnAddRenda" class="btn">Adicionar</button>
      </div>
      <div class="space-top">
        <table id="tblRenda"><thead><tr><th>DescriÃ§Ã£o</th><th>Data</th><th class="right">Valor</th><th></th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <!-- DESPESAS -->
    <section id="tab-despesas" class="tab card" hidden>
      <h2>ðŸ“Œ Despesas</h2>
      <div class="row">
        <div class="grow"><label>DescriÃ§Ã£o</label><input id="despNome"></div>
        <div class="grow"><label>Valor</label><input id="despValor" type="number" step="0.01"></div>
        <div class="grow"><label>Data vencimento</label><input id="despData" type="date"></div>
        <div class="grow"><label>Tipo</label>
          <select id="despTipo"></select>
        </div>
        <div class="row-inline">
          <input id="novoTipo" placeholder="Novo tipo" style="width:120px">
          <button id="btnAddTipo" class="btn ghost">+</button>
        </div>
        <button id="btnAddDesp" class="btn">Adicionar</button>
      </div>
      <div class="space-top">
        <table id="tblDesp"><thead><tr><th>DescriÃ§Ã£o</th><th>Data</th><th>Tipo</th><th class="right">Valor</th><th></th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <!-- CARTÃ•ES -->
    <section id="tab-cartoes" class="tab card" hidden>
      <h2>ðŸ’³ CartÃµes</h2>
      <div class="row">
        <div class="grow"><label>CartÃ£o</label><input id="ccNome"></div>
        <div class="grow"><label>Vencimento</label><input id="ccVenc" type="date"></div>
        <div class="grow"><label>Valor usado</label><input id="ccValor" type="number" step="0.01"></div>
        <button id="btnAddCC" class="btn">Adicionar</button>
      </div>
      <div class="space-top">
        <table id="tblCC"><thead><tr><th>CartÃ£o</th><th>Vencimento</th><th class="right">Valor usado</th><th></th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <!-- Config Dados -->
    <section id="tab-relatorios" class="tab card" hidden>
      <h2>ðŸ“… Config Dados</h2>
      <div id="listaReservas"></div>
      <div class="space-top">
        <button id="btnReset" class="btn danger">Limpar dados</button>
        <div class="note">Dados salvos no seu dispositivo (localStorage)</div>
      </div>
    </section>
  </main>
  <script>
  // ======= FUNÃ‡Ã•ES GERAIS =======
  const fmtBRL = (n) => (n||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  const parseN = (v) => Number(String(v).replace(',','.'))||0;
  const today = () => new Date();
  const getPeriod = (d) => {
    const date=new Date(d||today());
    return date.getFullYear()+"-"+String(date.getMonth()+1).padStart(2,'0');
  };

  let state = JSON.parse(localStorage.getItem('fin-state')||'{}');
  if(!state.periodos) state={periodos:{},tipos:["Moradia","Transporte","AlimentaÃ§Ã£o","SaÃºde","ServiÃ§os","EducaÃ§Ã£o","Outros"]};
  let currentPeriod;

  function ensurePeriod(p){
    if(!state.periodos[p]) state.periodos[p]={rendas:[],despesas:[],cartoes:[]};
  }
  function save(){ localStorage.setItem('fin-state',JSON.stringify(state)); renderAll(); }

  // ======= PERIODOS =======
  function renderPeriods(){
    const sel=document.getElementById('periodSelect'); sel.innerHTML="";
    const ps=Object.keys(state.periodos).sort();
    ps.forEach(p=>{
      const opt=document.createElement('option');
      opt.value=p; opt.textContent=p; sel.appendChild(opt);
    });
    if(!currentPeriod){currentPeriod=getPeriod(); ensurePeriod(currentPeriod);}
    if(!ps.includes(currentPeriod)){ensurePeriod(currentPeriod);}
    sel.value=currentPeriod;
    sel.onchange=()=>{currentPeriod=sel.value; renderAll();};
  }

  // ======= RENDAS =======
  document.getElementById('btnAddRenda').onclick=()=>{
    const nome=document.getElementById('rendaNome').value.trim();
    const valor=parseN(document.getElementById('rendaValor').value);
    const data=document.getElementById('rendaData').value;
    if(!nome||!valor||!data){alert("Preencha os campos");return;}
    const p=getPeriod(data);
    ensurePeriod(p);
    state.periodos[p].rendas.push({id:Date.now(),nome,valor,data});
    currentPeriod=p;
    document.getElementById('rendaNome').value="";
    document.getElementById('rendaValor').value="";
    document.getElementById('rendaData').value="";
    save();
  };
  function renderRenda(){
    ensurePeriod(currentPeriod);
    const tb=document.querySelector('#tblRenda tbody'); tb.innerHTML="";
    state.periodos[currentPeriod].rendas.forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.nome}</td><td>${new Date(r.data).toLocaleDateString()}</td><td class="right">${fmtBRL(r.valor)}</td><td><button class="btn ghost">X</button></td>`;
      tr.querySelector('button').onclick=()=>{state.periodos[currentPeriod].rendas=state.periodos[currentPeriod].rendas.filter(x=>x.id!==r.id); save();};
      tb.appendChild(tr);
    });
  }

  // ======= TIPOS DESPESAS =======
  function renderTipos(){
    const sel=document.getElementById('despTipo'); sel.innerHTML="";
    state.tipos.forEach(t=>{const o=document.createElement('option'); o.textContent=t; sel.appendChild(o);});
  }
  document.getElementById('btnAddTipo').onclick=()=>{
    const v=document.getElementById('novoTipo').value.trim();
    if(v){state.tipos.push(v); document.getElementById('novoTipo').value=""; save();}
  };

  // ======= DESPESAS =======
  document.getElementById('btnAddDesp').onclick=()=>{
    const nome=document.getElementById('despNome').value.trim();
    const valor=parseN(document.getElementById('despValor').value);
    const data=document.getElementById('despData').value;
    const tipo=document.getElementById('despTipo').value;
    if(!nome||!valor||!data){alert("Preencha os campos");return;}
    const p=getPeriod(data);
    ensurePeriod(p);
    state.periodos[p].despesas.push({id:Date.now(),nome,valor,data,tipo});
    currentPeriod=p;
    document.getElementById('despNome').value="";
    document.getElementById('despValor').value="";
    document.getElementById('despData').value="";
    save();
  };
  function renderDesp(){
    ensurePeriod(currentPeriod);
    const tb=document.querySelector('#tblDesp tbody'); tb.innerHTML="";
    state.periodos[currentPeriod].despesas.forEach(d=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${d.nome}</td><td>${new Date(d.data).toLocaleDateString()}</td><td>${d.tipo}</td><td class="right">${fmtBRL(d.valor)}</td><td><button class="btn ghost">X</button></td>`;
      tr.querySelector('button').onclick=()=>{state.periodos[currentPeriod].despesas=state.periodos[currentPeriod].despesas.filter(x=>x.id!==d.id); save();};
      tb.appendChild(tr);
    });
  }

  // ======= CARTÃ•ES =======
  document.getElementById('btnAddCC').onclick=()=>{
    const nome=document.getElementById('ccNome').value.trim();
    const valor=parseN(document.getElementById('ccValor').value);
    const venc=document.getElementById('ccVenc').value;
    if(!nome||!valor||!venc){alert("Preencha os campos");return;}
    const p=getPeriod(venc);
    ensurePeriod(p);
    state.periodos[p].cartoes.push({id:Date.now(),nome,valor,venc});
    currentPeriod=p;
    document.getElementById('ccNome').value="";
    document.getElementById('ccValor').value="";
    document.getElementById('ccVenc').value="";
    save();
  };
  function renderCC(){
    ensurePeriod(currentPeriod);
    const tb=document.querySelector('#tblCC tbody'); tb.innerHTML="";
    state.periodos[currentPeriod].cartoes.forEach(c=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${c.nome}</td><td>${new Date(c.venc).toLocaleDateString()}</td><td class="right">${fmtBRL(c.valor)}</td><td><button class="btn ghost">X</button></td>`;
      tr.querySelector('button').onclick=()=>{state.periodos[currentPeriod].cartoes=state.periodos[currentPeriod].cartoes.filter(x=>x.id!==c.id); save();};
      tb.appendChild(tr);
    });
  }

  // ======= DASHBOARD =======
  function renderDashboard(){
    ensurePeriod(currentPeriod);
    const rendas=state.periodos[currentPeriod].rendas||[];
    const despesas=state.periodos[currentPeriod].despesas||[];
    const cartoes=state.periodos[currentPeriod].cartoes||[];
    const totalR=rendas.reduce((s,x)=>s+x.valor,0);
    const totalD=despesas.reduce((s,x)=>s+x.valor,0);
    const totalC=cartoes.reduce((s,x)=>s+x.valor,0);
    const saldo=totalR; //alterei aqui
    document.getElementById('kpiSaldo').textContent=fmtBRL(saldo);
    document.getElementById('kpiSobra').textContent=fmtBRL(saldo-totalD-totalC);

    const eventos=[...despesas.map(d=>({data:d.data,nome:d.nome})),...cartoes.map(c=>({data:c.venc,nome:c.nome}))];
    const futuros=eventos.filter(e=>new Date(e.data)>=today());
    futuros.sort((a,b)=>new Date(a.data)-new Date(b.data));
    document.getElementById('kpiVencimento').textContent=futuros.length? new Date(futuros[0].data).toLocaleDateString()+" - "+futuros[0].nome:"â€”";
  }

  // ======= Config Dados =======
  document.getElementById('btnReset').onclick=()=>{ if(confirm("Apagar todos os dados?")){localStorage.removeItem('fin-state'); location.reload();} };

  // ======= TABS =======
  const tabNames=[["dashboard","Dashboard"],["renda","Renda"],["despesas","Despesas"],["cartoes","CartÃµes"],["relatorios","Config Dados"]];
  function renderTabs(){
    const nav=document.getElementById('tabs'); nav.innerHTML="";
    tabNames.forEach(([id,label],i)=>{
      const b=document.createElement('button'); b.textContent=label; if(i==0) b.classList.add('active');
      b.onclick=()=>{document.querySelectorAll('.tab').forEach(t=>t.hidden=true); document.getElementById('tab-'+id).hidden=false; document.querySelectorAll('nav button').forEach(x=>x.classList.remove('active')); b.classList.add('active');};
      nav.appendChild(b);
    });
    document.getElementById('tab-dashboard').hidden=false;
  }

  // ======= TEMA =======
  const themeToggle=document.getElementById('themeToggle');
  const themeIcon=document.getElementById('themeIcon');
  function applyTheme(){
    if(localStorage.getItem('theme')==='light'){document.body.classList.add('light'); themeToggle.checked=false; themeIcon.textContent='ðŸŒž';}
    else {document.body.classList.remove('light'); themeToggle.checked=true; themeIcon.textContent='ðŸŒ™';}
  }
  themeToggle.onchange=()=>{localStorage.setItem('theme', themeToggle.checked?'dark':'light'); applyTheme();};

  // ======= RENDER ALL =======
  function renderAll(){ renderPeriods(); renderRenda(); renderDesp(); renderCC(); renderDashboard(); renderTipos(); }

  // init
  renderTabs(); applyTheme(); renderAll();
  </script>
  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("Service Worker registrado"));
  }
  </script>

</body>
</html>
